# Codebase Map

> **Status:** Auto-generated by Cartographer
> **Last Updated:** 2026-01-14

## 1. System Overview

```mermaid
graph TB
    Client[Web Client (Next.js)] --> features_dash[Dashboard Feature]
    Client --> features_session[Study Session Feature]
    Client --> features_lib[Library Feature]
    
    features_lib --> AI[Gemini 2.0 Flash Lite]
    features_lib --> DB[(Postgres/Prisma)]
    features_session --> ServerActions[Server Actions]
    ServerActions --> DB
    
    subgraph "Source (src)"
        App[App Router] --> Features
        Features --> Lib[Lib / Core]
    end
```

## 2. Key Modules

### `src/app/` (Routes)

* **Strategy:** App Router with Feature-Sliced Architecture.
* **Key Flows:**
    * `/`: Landing Page
    * `/study/active?mode=[mode]`: Active Study Session. Fetches questions server-side.

### `src/features/` (Domain Logic)

| Feature | Status | Description | Key Files |
| --- | --- | --- | --- |
| `dashboard` | ðŸŸ¢ Active | Main user dashboard and mode selection | [DashboardMenu.tsx](../src/features/dashboard/ui/DashboardMenu.tsx) |
| `library` | ðŸŸ¢ Active | Content ingestion and AI processing | [process-content.ts](../src/features/library/actions/process-content.ts) |
| `study-session` | ðŸŸ¢ Active | Flashcard interface with Real Data support | [StudySession.tsx](../src/features/study-session/ui/StudySession.tsx), [get-questions.ts](../src/features/study-session/actions/get-questions.ts) |

### `src/lib/` (Core Logic)

| File | Purpose | Critical Dependencies |
| --- | --- | --- |
| [prisma.ts](../src/lib/prisma.ts) | Prisma Singleton with pg-adapter | `DATABASE_URL`, `@/app/generated/prisma/client` |

### `prisma/` (Data Layer)

| File | Purpose | Notes |
| --- | --- | --- |
| [schema.prisma](../prisma/schema.prisma) | Database Schema | Defines `User`, `ContentSource`, `StudyUnit`, `Question` |

## 3. Data Flow

### AI Content Processing
1.  **Input:** User provides text/source via Library.
2.  **Action:** `processContent` (Server Action) calls `generateText` using `google/gemini-2.0-flash-lite`.
3.  **Output:** Structured JSON (`output.object.units`) containing Text or Code cards.
4.  **Storage:** Saved to Postgres transactively (Source -> StudyUnit -> Question).

### Active Session Flow
1.  **Route:** `src/app/study/active/page.tsx` receives `searchParams` (mode).
2.  **Fetch:** Calls `getQuestionsForSession(mode)` (Server Action).
3.  **Query:** Prisma fetches questions (Limit: 5/15/50 based on mode, sorted by CreatedAt).
4.  **Render:** Passes `initialCards` to `<StudySession />` Client Component.

## 4. "Gotchas" & Warnings

*   [ ] **Generated Path:** Prisma client is generated into `@/app/generated/prisma/client`.
*   [ ] **ID Types:** `FlashCard` interface expects `number` or `string` IDs, but DB uses CUIDs. Current mapper has a workaround/fix.
*   [ ] **AI Model:** Hardcoded to `google/gemini-2.0-flash-lite`. Ensure credentials are set.
